# ADR 001: WebSocket 通信协议选择

## 状态
✅ 已采纳

## 背景
在 V0.1 版本中，我们需要实现基础的实时文本同步功能。需要选择客户端和服务器之间的通信协议。

## 考虑的方案

### 方案一: HTTP 长轮询 (Long Polling)
**优点**:
- 兼容性好，所有浏览器都支持
- 易于调试和测试

**缺点**:
- 延迟较高，实时性不够好
- 服务器压力大，每个请求都需要处理

### 方案二: Server-Sent Events (SSE)
**优点**:
- 简单的服务器到客户端推送
- 自动重连机制
- 文本协议，易于调试

**缺点**:
- 只能服务器向客户端推送，双向通信需要额外HTTP请求

### 方案三: WebSocket
**优点**:
- 真正的全双工实时通信
- 低延迟，高效率
- 广泛的浏览器支持

**缺点**:
- 需要额外的协议升级处理
- 需要处理连接状态管理

## 决策
选择 **方案三: WebSocket**，原因如下：

1. **实时性要求**: 文本编辑器需要极低的延迟来提供流畅的协作体验
2. **双向通信**: 需要支持客户端到服务器和服务器到客户端的实时消息传递
3. **技术熟悉度**: 团队对 WebSocket 有相关经验，Rust 的 Axum 框架提供了良好的 WebSocket 支持
4. **扩展性**: WebSocket 为未来的高级功能（如操作转换、光标同步）提供了更好的基础

## 后果
- 需要实现 WebSocket 连接管理（重连、错误处理）
- 需要定义消息协议格式
- 服务器需要支持 WebSocket 连接
- 需要考虑跨浏览器兼容性（现代浏览器都支持）

## 协议格式
使用简单的文本消息格式：
```json
// 客户端 -> 服务器
"文本内容"

// 服务器 -> 客户端  
"文本内容"